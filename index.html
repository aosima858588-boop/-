<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=yes">
    <title>æµ·è±šç»æµ Â· æ‰‹æœºç‰ˆï¼ˆé¡ºåºè”åŠ¨ç‰ˆï¼‰</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:opsz,wght@14..32,400;14..32,500;14..32,600;14..32,700;14..32,800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            background: #f0f7fc;
            font-family: 'Inter', sans-serif;
            padding: 16px 12px 30px 12px;
            min-height: 100vh;
            display: flex;
            justify-content: center;
        }
        .phone-frame {
            max-width: 480px;
            width: 100%;
            display: flex;
            flex-direction: column;
            gap: 18px;
        }
        .hero {
            background: rgba(255,255,255,0.8);
            backdrop-filter: blur(12px);
            border-radius: 36px;
            padding: 22px 20px;
            border: 1px solid rgba(255,255,255,0.9);
            box-shadow: 0 8px 20px -8px #295e7e;
        }
        .hero h1 {
            font-size: 1.8rem;
            font-weight: 800;
            background: linear-gradient(145deg, #0a4b6e, #247da3);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            display: flex;
            align-items: center;
            gap: 12px;
            border-left: 6px solid #247da3;
            padding-left: 16px;
        }
        .hero h1 i {
            background: #1f6f94;
            color: white;
            padding: 12px;
            border-radius: 50%;
            font-size: 1.5rem;
        }
        .hero .sub {
            color: #2b6e91;
            margin-left: 22px;
            font-size: 0.9rem;
            margin-top: 4px;
        }
        .card {
            background: white;
            border-radius: 32px;
            padding: 20px 18px;
            box-shadow: 0 8px 18px -8px #a3c2da;
        }
        .card-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 16px;
            border-bottom: 2px dashed #c5dff0;
            padding-bottom: 10px;
        }
        .card-header i {
            font-size: 1.5rem;
            color: #247da3;
            background: #dcf0fd;
            padding: 10px;
            border-radius: 30px;
        }
        .card-header h3 {
            font-size: 1.2rem;
            font-weight: 600;
            color: #135e83;
        }
        .dist-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }
        .dist-cell {
            background: #f3f9fe;
            border-radius: 24px;
            padding: 14px 8px;
            text-align: center;
            border-left: 4px solid #7fb9da;
        }
        .dist-cell .label {
            font-size: 0.7rem;
            color: #366f94;
        }
        .dist-cell .number {
            font-size: 1rem;
            font-weight: 700;
            color: #0b3e5a;
            font-family: 'Courier New', monospace;
        }
        .dist-cell .percent {
            font-size: 0.7rem;
            color: #749bb3;
        }
        .pool-stats {
            display: flex;
            gap: 16px;
            justify-content: space-around;
            margin-bottom: 16px;
        }
        .pool-item {
            background: #f3f9fe;
            border-radius: 28px;
            padding: 14px 16px;
            text-align: center;
            flex: 1;
        }
        .pool-item .label {
            font-size: 0.7rem;
            color: #2f6d8b;
        }
        .pool-item .number {
            font-size: 1.2rem;
            font-weight: 700;
            color: #0f4d70;
            font-family: 'Courier New', monospace;
        }
        .price-row {
            background: linear-gradient(115deg, #1a618b, #247da3);
            border-radius: 30px;
            padding: 14px 20px;
            color: white;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        .price-row span:last-child {
            background: rgba(255,255,255,0.15);
            padding: 6px 20px;
            border-radius: 40px;
            font-size: 1.4rem;
            font-family: 'Courier New', monospace;
        }
        .mini-row {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 12px 0;
        }
        .mini-card {
            background: #f4f9fe;
            border-radius: 24px;
            padding: 14px 10px;
            flex: 1 1 80px;
            border-left: 5px solid #f4a261;
        }
        .mini-card .title {
            font-size: 0.65rem;
            color: #316d8f;
        }
        .mini-card .number {
            font-size: 1rem;
            font-weight: 700;
            color: #0b4b6b;
            font-family: 'Courier New', monospace;
        }
        .trade-highlight {
            background: #fff1dc;
            border-radius: 32px;
            padding: 16px 14px;
            border: 2px solid #f4a261;
            display: flex;
            flex-wrap: wrap;
            gap: 16px;
            justify-content: space-around;
        }
        .trade-item .label {
            font-size: 0.65rem;
            color: #8f5f2b;
        }
        .trade-item .value {
            font-size: 1.1rem;
            font-weight: 800;
            color: #b45f1b;
            font-family: 'Courier New', monospace;
        }
        .control-panel {
            background: white;
            border-radius: 36px;
            padding: 22px 18px;
        }
        .mode-switch {
            display: flex;
            gap: 10px;
            margin-bottom: 18px;
        }
        .mode-btn {
            flex: 1;
            background: #eef4fa;
            border: none;
            padding: 12px;
            border-radius: 40px;
            font-weight: 600;
            color: #1a5f82;
            font-size: 0.9rem;
            cursor: pointer;
        }
        .mode-btn.active {
            background: #247da3;
            color: white;
        }
        .slider-area {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .slider-label {
            font-weight: 600;
            color: #1a5f82;
            font-size: 0.95rem;
        }
        input[type=range] {
            width: 100%;
            height: 8px;
            background: #d0e6f5;
            border-radius: 10px;
            -webkit-appearance: none;
        }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 26px;
            height: 26px;
            background: #247da3;
            border-radius: 50%;
            box-shadow: 0 2px 6px #0f4d70;
            cursor: pointer;
        }
        .selected-amount {
            font-size: 1.3rem;
            font-weight: 700;
            color: #1b6f93;
            font-family: 'Courier New', monospace;
            text-align: center;
        }
        .action-btns {
            display: flex;
            gap: 12px;
            margin-top: 20px;
        }
        .btn {
            background: #247da3;
            color: white;
            font-weight: 700;
            padding: 14px 20px;
            border-radius: 50px;
            border: none;
            font-size: 1rem;
            flex: 1;
            cursor: pointer;
        }
        .btn.secondary {
            background: #3a7b9b;
        }
        .history-panel {
            background: #e5f2fd;
            border-radius: 32px;
            padding: 18px;
        }
        .history-flex {
            display: flex;
            flex-wrap: wrap;
            gap: 16px;
            justify-content: space-between;
        }
        .history-item {
            background: white;
            border-radius: 24px;
            padding: 10px 16px;
            flex: 1 1 100px;
            text-align: center;
        }
        .history-item .label {
            font-size: 0.7rem;
            color: #2f6d8b;
        }
        .history-item .number {
            font-family: 'Courier New', monospace;
            font-weight: 700;
            font-size: 1rem;
        }
        .market-card {
            background: #e0f0fa;
            border-radius: 32px;
            padding: 20px 18px;
            border-left: 6px solid #2ecc71;
        }
        .market-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 10px;
        }
        .market-header i {
            font-size: 1.5rem;
            color: #27ae60;
        }
        .market-header h4 {
            font-size: 1.2rem;
            color: #1e6f5c;
        }
        .market-desc {
            font-size: 0.9rem;
            color: #1a4b5a;
            margin: 8px 0;
            line-height: 1.5;
        }
        .dual-section {
            display: flex;
            flex-direction: column;
            gap: 18px;
        }
        .stake-card, .dump-card {
            background: #fff7e5;
            border-radius: 32px;
            padding: 22px 18px;
            border-left: 6px solid #f4a261;
        }
        .dump-card {
            background: #f3eafa;
            border-left-color: #9b6bc0;
        }
        .stat-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin: 15px 0;
        }
        .stat-cell {
            background: white;
            border-radius: 24px;
            padding: 12px;
            text-align: center;
        }
        .stat-cell .label {
            font-size: 0.7rem;
            color: #4a5f6b;
        }
        .stat-cell .value {
            font-size: 1.2rem;
            font-weight: 700;
            color: #0f4d70;
            font-family: 'Courier New', monospace;
        }
        .input-group {
            display: flex;
            align-items: center;
            background: white;
            border-radius: 40px;
            padding: 4px 8px 4px 16px;
            border: 1px solid #ccc;
            margin: 10px 0;
        }
        .input-group input {
            width: 100px;
            border: none;
            padding: 10px 5px;
            font-size: 1rem;
            font-weight: 600;
            text-align: center;
            font-family: 'Courier New', monospace;
        }
        .result-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-top: 15px;
        }
        .result-cell {
            background: white;
            border-radius: 24px;
            padding: 12px;
            text-align: center;
        }
        .result-cell .label {
            font-size: 0.65rem;
            color: #5f3b5f;
        }
        .result-cell .value {
            font-size: 1rem;
            font-weight: 700;
            color: #4a2c6b;
            font-family: 'Courier New', monospace;
        }
        footer {
            text-align: center;
            color: #4a7897;
            font-size: 0.75rem;
            margin-top: 16px;
        }
        .slider-unit {
            font-size: 1rem;
            font-weight: 500;
            margin-left: 6px;
            color: #247da3;
        }
        .dump-note {
            font-size: 0.75rem;
            color: #6b4f8c;
            margin-top: 8px;
        }
    </style>
</head>
<body>
<div class="phone-frame">

    <!-- æ ‡é¢˜å¤´ -->
    <div class="hero">
        <h1><i class="fas fa-dolphin"></i> æµ·è±šç»æµ</h1>
        <div class="sub">æ‰‹æœºä¼˜åŒ–ç‰ˆ Â· é£è½®æ•ˆåº”</div>
    </div>

    <!-- æŒå¸åˆ†å¸ƒ -->
    <div class="card">
        <div class="card-header"><i class="fas fa-chart-pie"></i><h3>æŒå¸åˆ†å¸ƒ</h3></div>
        <div class="dist-grid">
            <div class="dist-cell"><span class="label">ç¤¾åŒºå¤šç­¾</span><div class="number" id="communityH">682,648,402</div><div class="percent" id="communityPct">68.26%</div></div>
            <div class="dist-cell"><span class="label">è´¨æŠ¼æ± </span><div class="number" id="stakeH">300,000,000</div><div class="percent" id="stakePct">30.00%</div></div>
            <div class="dist-cell"><span class="label">å¤–éƒ¨ç”¨æˆ·</span><div class="number" id="externalH">0</div><div class="percent" id="externalPct">0.00%</div></div>
            <div class="dist-cell"><span class="label">LPæ± </span><div class="number" id="lpH">17,351,598</div><div class="percent" id="lpPct">1.74%</div></div>
        </div>
    </div>

    <!-- æµåŠ¨æ€§æ±  + ä»·æ ¼ -->
    <div class="card">
        <div class="card-header"><i class="fas fa-water"></i><h3>æµåŠ¨æ€§æ± </h3></div>
        <div class="pool-stats">
            <div class="pool-item"><span class="label">USDT</span><div class="number" id="poolU">110,000</div></div>
            <div class="pool-item"><span class="label">H</span><div class="number" id="poolH">17,351,598</div></div>
        </div>
        <div class="price-row">
            <span>å½“å‰ä»·æ ¼</span>
            <span id="currentPrice">0.00634</span>
        </div>
    </div>

    <!-- å›½åº“/å¤šç­¾/å›è´­ -->
    <div class="card">
        <div class="card-header"><i class="fas fa-landmark"></i><h3>å›½åº“ & å›è´­</h3></div>
        <div class="mini-row">
            <div class="mini-card"><span class="title">å›½åº“ä½™é¢ (U)</span><div class="number" id="treasuryBal">0</div></div>
            <div class="mini-card"><span class="title">å¤šç­¾å‚¨å¤‡ (U)</span><div class="number" id="multiSigBal">0</div></div>
            <div class="mini-card"><span class="title">å›è´­æ¬¡æ•°</span><div class="number" id="buybackCount">0</div></div>
            <div class="mini-card"><span class="title">å›è´­Hæ€»é‡</span><div class="number" id="buybackTotalH">0</div></div>
            <div class="mini-card"><span class="title">åˆ†çº¢æ±  (U)</span><div class="number" id="dividendPool">0</div></div>
        </div>
    </div>

    <!-- æœ€è¿‘äº¤æ˜“ -->
    <div class="trade-highlight">
        <div class="trade-item"><span class="label">èŠ±è´¹ USDT</span><div class="value" id="lastSpent">0</div></div>
        <div class="trade-item"><span class="label">è·å¾— H</span><div class="value" id="lastObtained">0</div></div>
        <div class="trade-item"><span class="label">æˆäº¤ä»·</span><div class="value" id="lastPrice">0.00634</div></div>
        <div class="trade-item"><span class="label">ç¨è´¹</span><div class="value" id="lastTax">0</div></div>
        <div class="trade-item"><span class="label">ç´¯è®¡ä¹°å…¥U</span><div class="value" id="totalBuyU">0</div></div>
        <div class="trade-item"><span class="label">ç´¯è®¡å–å‡ºH</span><div class="value" id="totalSellH">0</div></div>
    </div>

    <!-- äº¤æ˜“æ§åˆ¶ -->
    <div class="control-panel">
        <div class="mode-switch">
            <button class="mode-btn active" id="modeBuy">ğŸ’µ ä¹°å…¥ H</button>
            <button class="mode-btn" id="modeSell">ğŸª™ å–å‡º H</button>
        </div>
        <div class="slider-area">
            <span class="slider-label" id="sliderLabel">ä¹°å…¥é‡‘é¢ (USDT)</span>
            <input type="range" id="actionSlider" min="100" max="100000" value="1000" step="100">
            <div>
                <span class="selected-amount" id="sliderValue">1,000</span>
                <span class="slider-unit" id="sliderUnit">USDT</span>
            </div>
        </div>
        <div class="action-btns">
            <button class="btn" id="executeBtn"><i class="fas fa-bolt"></i> æ‰§è¡Œ</button>
            <button class="btn secondary" id="resetBtn"><i class="fas fa-undo-alt"></i> é‡ç½®</button>
        </div>
    </div>

    <!-- å›è´­å†å² -->
    <div class="history-panel">
        <div style="display:flex; align-items:center; gap:8px; margin-bottom:12px;">
            <i class="fas fa-history" style="color:#0f4d70;"></i>
            <h4 style="color:#0f4d70;">æœ€è¿‘å›è´­</h4>
        </div>
        <div class="history-flex">
            <div class="history-item"><span class="label">å›è´­æ•°é‡</span><br><span class="number" id="lastBuybackH">0</span> H</div>
            <div class="history-item"><span class="label">å›è´­ä»·æ ¼</span><br><span class="number" id="lastBuybackPrice">0.00634</span></div>
            <div class="history-item"><span class="label">ç´¯è®¡å›è´­</span><br><span class="number" id="cumBuybackH">0</span> H</div>
        </div>
    </div>

    <!-- å¸‚åœºç¯å¢ƒæµ‹è¯• -->
    <div class="market-card">
        <div class="market-header">
            <i class="fas fa-trophy"></i>
            <h4>å¸‚åœºç¯å¢ƒæµ‹è¯•</h4>
        </div>
        <div class="market-desc">
            <p>âœ¨ <strong>è´¨æŠ¼Häº«æœ€é«˜1.2%æ—¥åˆ©ç‡ + æ— å¸¸æŸå¤±è¡¥å¿</strong><br>
            å‚ä¸OKXäº¤æ˜“èµ›å¯è·åŒé‡å¥–åŠ±ï¼šè´¨æŠ¼æ”¶ç›Šä¸ç©ºæŠ•å¥–åŠ±å åŠ ã€‚å³ä½¿ä»·æ ¼æ³¢åŠ¨ï¼Œè´¨æŠ¼çš„Hä¾ç„¶äº§ç”Ÿæ¯æ—¥æ”¶ç›Šï¼ŒåŒæ—¶äº¤æ˜“èµ›è¿”ä½£å’Œå¥–é‡‘ä¸ºç”¨æˆ·æä¾›é¢å¤–æ¿€åŠ±ã€‚</p>
            <p style="margin-top:6px;">ğŸ‘‰ å½“å‰å¤–éƒ¨æŒå¸å¯è´¨æŠ¼æ¨¡æ‹Ÿè§ä¸‹æ–¹ã€‚</p>
        </div>
    </div>

    <!-- è´¨æŠ¼ + ç ¸ç›˜ï¼ˆåŸºäºçœŸå®å¤–éƒ¨æŒå¸ï¼‰ -->
    <div class="dual-section">
        <!-- è´¨æŠ¼åŒºï¼ˆä¸å˜ï¼‰ -->
        <div class="stake-card">
            <h4 style="display:flex; gap:8px;"><i class="fas fa-layer-group"></i> å½“å‰å¤–éƒ¨æŒå¸è´¨æŠ¼</h4>
            <div style="margin:10px 0;">å¤–éƒ¨æŒå¸: <strong class="number" id="externalForStake">0</strong> H</div>
            <select id="stakeDuration" style="width:100%; padding:10px; border-radius:40px; border:1px solid #ccc;">
                <option value="0.5">1-7å¤© (0.5%)</option>
                <option value="0.6">8-15å¤© (0.6%)</option>
                <option value="0.8">16-30å¤© (0.8%)</option>
                <option value="1.0">31-60å¤© (1.0%)</option>
                <option value="1.2" selected>61å¤©ä»¥ä¸Š (1.2%)</option>
            </select>
            <div class="stat-grid" style="margin-top:15px;">
                <div class="stat-cell"><span class="label">æ¯æ—¥æ”¶ç›Š</span><span class="value" id="dailyReward">0</span> H</div>
                <div class="stat-cell"><span class="label">ç­‰å€¼USDT</span><span class="value" id="dailyUsdt">0</span></div>
            </div>
            <div style="display:flex; gap:10px; align-items:center; margin:12px 0;">
                <span>å¤©æ•°:</span>
                <input type="number" id="stakeDays" value="7" min="1" max="365" style="width:70px; padding:8px; border-radius:40px; border:1px solid #aaa;">
            </div>
            <div class="stat-grid">
                <div class="stat-cell"><span class="label">ç´¯è®¡æ”¶ç›Š</span><span class="value" id="cumulativeReward">0</span> H</div>
                <div class="stat-cell"><span class="label">ç´¯è®¡ä»·å€¼</span><span class="value" id="cumulativeValue">0</span> U</div>
            </div>
        </div>

        <!-- ç ¸ç›˜åŒºï¼ˆåŸºäºçœŸå®å¤–éƒ¨æŒå¸ï¼‰ -->
        <div class="dump-card">
            <h4 style="display:flex; gap:8px;"><i class="fas fa-chart-line"></i> çœŸå®ç ¸ç›˜æ¨¡æ‹Ÿï¼ˆåŸºäºå½“å‰å¤–éƒ¨æŒå¸ï¼‰</h4>
            <p style="font-size:0.8rem; color:#4a2c6b; margin-bottom:8px;">âš¡ è¾“å…¥è´¨æŠ¼å¤©æ•°ï¼Œç³»ç»Ÿå°†æ¨¡æ‹ŸæŠŠå½“å‰æ‰€æœ‰å¤–éƒ¨æŒå¸ï¼ˆå«æ”¶ç›Šï¼‰ä¸€æ¬¡æ€§å–å‡ºï¼Œä»·æ ¼éšæ·±åº¦å˜åŒ–ã€‚</p>
            <div style="background:#e6d4f5; border-radius:30px; padding:12px; margin-bottom:10px;">
                <div style="display:flex; justify-content:space-between;">
                    <span>å½“å‰å¤–éƒ¨æŒå¸:</span>
                    <strong class="number" id="dumpExternalDisplay">0</strong> H
                </div>
                <div style="display:flex; justify-content:space-between; margin-top:5px;">
                    <span>å½“å‰ä»·æ ¼:</span>
                    <strong class="number" id="dumpCurrentPriceDisplay">0.00634</strong> U
                </div>
            </div>
            <div class="input-group">
                <span>è´¨æŠ¼å¤©æ•°</span>
                <input type="number" id="dumpDays" value="100" min="1" max="3650" step="1">
            </div>
            <button class="btn" id="simulateDumpBtn" style="background:#8a4eb3; width:100%; margin:8px 0;">æ¨¡æ‹Ÿç ¸ç›˜</button>
            <div class="result-grid">
                <div class="result-cell"><span class="label">ç´¯è®¡æ”¶ç›Š</span><span class="value" id="dumpRewardH">0</span> H</div>
                <div class="result-cell"><span class="label">æ€»ç ¸ç›˜é‡</span><span class="value" id="totalDumpH">0</span> H</div>
                <div class="result-cell"><span class="label">å–å‡ºåä»·æ ¼</span><span class="value" id="dumpAfterPrice">0.00634</span> U</div>
                <div class="result-cell"><span class="label">å–å‡ºæ‰€å¾—U</span><span class="value" id="dumpObtainedU">0</span> U</div>
                <div class="result-cell"><span class="label">äº¤æ˜“ç¨è´¹</span><span class="value" id="dumpTax">0</span> U</div>
                <div class="result-cell"><span class="label">å‡€å¾—U</span><span class="value" id="dumpNetU">0</span> U</div>
                <div class="result-cell"><span class="label">å½“å‰å¸‚å€¼</span><span class="value" id="dumpMarketValue">0</span> U</div>
                <div class="result-cell"><span class="label">äºæŸé¢</span><span class="value" id="dumpLossU">0</span> U</div>
                <div class="result-cell"><span class="label">äºæŸç‡</span><span class="value" id="dumpLossRate">0%</span></div>
            </div>
            <div class="dump-note">* äºæŸ = å½“å‰å¸‚å€¼ - å‡€å¾—Uã€‚å¸‚å€¼ = å¤–éƒ¨æŒå¸ Ã— å½“å‰ä»·ã€‚</div>
        </div>
    </div>

    <footer>å›½åº“â‰¥1000Uè§¦å‘å›è´­(300Uä¹°Hï¼Œ700Uå…¥å¤šç­¾) Â· å…ˆä¹°å…¥/å–å‡ºäº§ç”Ÿå¤–éƒ¨æŒå¸ï¼Œå†ç ¸ç›˜æ¨¡æ‹Ÿ</footer>
</div>

<script>
(function() {
    // ---------- å¸¸é‡ ----------
    const TOTAL_SUPPLY = 1_000_000_000;
    const TAX = 0.05;                     // 5% äº¤æ˜“ç¨
    const REPUBLIC_THRESHOLD = 1000;       // å›½åº“è¾¾åˆ°1000Uè§¦å‘å›è´­
    const REPUBLIC_BUYBACK = 300;          // æ¯æ¬¡å›è´­ä½¿ç”¨300Uä¹°å…¥H
    const REPUBLIC_MULTISIG = 700;         // æ¯æ¬¡å›è´­åŒæ—¶å‘å¤šç­¾å‚¨å¤‡å­˜å…¥700U

    // ---------- çŠ¶æ€å˜é‡ ----------
    let communityH = 682_648_402;           // ç¤¾åŒºå¤šç­¾æŒå¸
    let stakePoolH = 300_000_000;           // è´¨æŠ¼æ± æŒå¸ï¼ˆå›ºå®šï¼‰
    let lpPoolH = 17_351_598;               // LPæ± ä¸­çš„Hæ•°é‡
    let lpPoolU = 110_000;                   // LPæ± ä¸­çš„USDTæ•°é‡

    let treasury = 0;                        // å›½åº“USDTï¼ˆæ¥è‡ªç¨è´¹ï¼‰
    let multiSig = 0;                        // å¤šç­¾å‚¨å¤‡USDT
    let buybackCount = 0;                     // å›è´­æ¬¡æ•°
    let totalBuybackH = 0;                    // ç´¯è®¡å›è´­Hæ€»é‡
    let lastBuybackH = 0;                     // æœ€è¿‘ä¸€æ¬¡å›è´­Hæ•°é‡
    let lastBuybackPrice = lpPoolU / lpPoolH;  // æœ€è¿‘å›è´­ä»·æ ¼

    let totalBuyUSDT = 0;                      // ç´¯è®¡ä¹°å…¥USDTæ€»é¢ï¼ˆå«ç¨ï¼‰
    let totalSellH = 0;                        // ç´¯è®¡å–å‡ºHæ€»é‡

    let lastSpent = 0;                         // æœ€è¿‘ä¸€æ¬¡äº¤æ˜“èŠ±è´¹ï¼ˆä¹°å…¥ä¸ºæ­£USDTï¼Œå–å‡ºä¸ºè´Ÿå‡€å¾—Uï¼‰
    let lastObtained = 0;                       // æœ€è¿‘ä¸€æ¬¡äº¤æ˜“è·å¾—ï¼ˆä¹°å…¥ä¸ºæ­£Hï¼Œå–å‡ºä¸ºè´ŸHï¼‰
    let lastTradePrice = lpPoolU / lpPoolH;     // æœ€è¿‘ä¸€æ¬¡äº¤æ˜“å‡ä»·
    let lastTax = 0;                            // æœ€è¿‘ä¸€æ¬¡äº¤æ˜“ç¨è´¹

    // ---------- è¾…åŠ©å‡½æ•°ï¼šå¤–éƒ¨æŒå¸ = æ€»ä¾›åº” - å…¶ä»– ----------
    function getExternalH() {
        return TOTAL_SUPPLY - communityH - stakePoolH - lpPoolH;
    }

    // ---------- DOM å…ƒç´  ----------
    const communitySpan = document.getElementById('communityH');
    const stakeSpan = document.getElementById('stakeH');
    const externalSpan = document.getElementById('externalH');
    const lpHSpan = document.getElementById('lpH');
    const communityPct = document.getElementById('communityPct');
    const stakePct = document.getElementById('stakePct');
    const externalPct = document.getElementById('externalPct');
    const lpPct = document.getElementById('lpPct');
    const poolUSpan = document.getElementById('poolU');
    const poolHSpan = document.getElementById('poolH');
    const currentPriceSpan = document.getElementById('currentPrice');
    const treasuryBalSpan = document.getElementById('treasuryBal');
    const multiSigBalSpan = document.getElementById('multiSigBal');
    const buybackCountSpan = document.getElementById('buybackCount');
    const buybackTotalHSpan = document.getElementById('buybackTotalH');
    const dividendPoolSpan = document.getElementById('dividendPool');

    const lastSpentSpan = document.getElementById('lastSpent');
    const lastObtainedSpan = document.getElementById('lastObtained');
    const lastPriceSpan = document.getElementById('lastPrice');
    const lastTaxSpan = document.getElementById('lastTax');
    const totalBuyUSpan = document.getElementById('totalBuyU');
    const totalSellHSpan = document.getElementById('totalSellH');

    const lastBuybackHSpan = document.getElementById('lastBuybackH');
    const lastBuybackPriceSpan = document.getElementById('lastBuybackPrice');
    const cumBuybackHSpan = document.getElementById('cumBuybackH');

    const externalForStake = document.getElementById('externalForStake');
    const dailyRewardSpan = document.getElementById('dailyReward');
    const dailyUsdtSpan = document.getElementById('dailyUsdt');
    const stakeDuration = document.getElementById('stakeDuration');
    const stakeDays = document.getElementById('stakeDays');
    const cumulativeRewardSpan = document.getElementById('cumulativeReward');
    const cumulativeValueSpan = document.getElementById('cumulativeValue');

    // ç ¸ç›˜æ¨¡æ‹Ÿå…ƒç´ 
    const dumpExternalDisplay = document.getElementById('dumpExternalDisplay');
    const dumpCurrentPriceDisplay = document.getElementById('dumpCurrentPriceDisplay');
    const dumpDaysInput = document.getElementById('dumpDays');
    const simulateDumpBtn = document.getElementById('simulateDumpBtn');
    const dumpRewardHSpan = document.getElementById('dumpRewardH');
    const totalDumpHSpan = document.getElementById('totalDumpH');
    const dumpAfterPriceSpan = document.getElementById('dumpAfterPrice');
    const dumpObtainedUSpan = document.getElementById('dumpObtainedU');
    const dumpTaxSpan = document.getElementById('dumpTax');
    const dumpNetUSpan = document.getElementById('dumpNetU');
    const dumpMarketValueSpan = document.getElementById('dumpMarketValue');
    const dumpLossUSpan = document.getElementById('dumpLossU');
    const dumpLossRateSpan = document.getElementById('dumpLossRate');

    const modeBuyBtn = document.getElementById('modeBuy');
    const modeSellBtn = document.getElementById('modeSell');
    const sliderLabel = document.getElementById('sliderLabel');
    const actionSlider = document.getElementById('actionSlider');
    const sliderValue = document.getElementById('sliderValue');
    const sliderUnit = document.getElementById('sliderUnit');
    const executeBtn = document.getElementById('executeBtn');
    const resetBtn = document.getElementById('resetBtn');

    let isBuyMode = true;   // å½“å‰æ¨¡å¼ true=ä¹°å…¥, false=å–å‡º

    // ---------- æ ¼å¼åŒ–å·¥å…· ----------
    function formatNumber(num) {
        return Math.floor(num).toLocaleString('en-US');
    }
    function formatFloat(num, d=2) {
        return num.toLocaleString('en-US', { minimumFractionDigits: d, maximumFractionDigits: d });
    }
    function formatPrice(p) {
        if (p < 0.0001) return p.toFixed(8);
        if (p < 0.01) return p.toFixed(6);
        if (p < 1) return p.toFixed(4);
        return p.toFixed(4);
    }

    // ---------- æ ¸å¿ƒï¼šå›è´­æ‰§è¡Œï¼ˆä»LPæ± ä¹°å…¥Hï¼ŒåŠ å…¥ç¤¾åŒºå¤šç­¾ï¼‰----------
    function performBuyback() {
        while (treasury >= REPUBLIC_THRESHOLD) {
            const buyU = REPUBLIC_BUYBACK;      // 300
            const multiU = REPUBLIC_MULTISIG;    // 700

            // æ’å®šä¹˜ç§¯ k = U * H
            const k = lpPoolU * lpPoolH;
            const newU = lpPoolU + buyU;
            const newH = k / newU;
            const hBought = lpPoolH - newH;      // ä»æ± ä¸­ä¹°å‡ºçš„H

            if (hBought <= 0) break;             // é˜²æ­¢æç«¯æƒ…å†µ

            // æ›´æ–°æµåŠ¨æ± 
            lpPoolU = newU;
            lpPoolH = newH;
            // ä¹°å…¥çš„Hè¿›å…¥ç¤¾åŒºå¤šç­¾
            communityH += hBought;
            // å¤šç­¾å‚¨å¤‡å¢åŠ 700U
            multiSig += multiU;
            // è®°å½•å›è´­æ•°æ®
            totalBuybackH += hBought;
            lastBuybackH = hBought;
            lastBuybackPrice = buyU / hBought;
            buybackCount++;
            // å›½åº“æ‰£é™¤1000U
            treasury -= REPUBLIC_THRESHOLD;
        }
    }

    // ---------- ä¹°å…¥é€»è¾‘ ----------
    function executeBuy(amountU) {
        if (amountU <= 0) return;
        const tax = amountU * TAX;
        const net = amountU - tax;
        if (net <= 0) return;

        const k = lpPoolU * lpPoolH;
        const newU = lpPoolU + net;
        const newH = k / newU;
        const hObtained = lpPoolH - newH;
        if (hObtained <= 0) return;

        const avgPrice = net / hObtained;

        // æ›´æ–°çŠ¶æ€
        lastSpent = amountU;
        lastObtained = hObtained;
        lastTradePrice = avgPrice;
        lastTax = tax;
        totalBuyUSDT += amountU;

        lpPoolU = newU;
        lpPoolH = newH;
        treasury += tax;

        performBuyback();    // å°è¯•å›è´­
        refreshAll();
    }

    // ---------- å–å‡ºé€»è¾‘ ----------
    function executeSell(amountH) {
        if (amountH <= 0) return;
        const external = getExternalH();
        if (amountH > external) {
            alert('å¤–éƒ¨æŒå¸ä¸è¶³');
            return;
        }

        const k = lpPoolU * lpPoolH;
        const newH = lpPoolH + amountH;
        const newU = k / newH;
        const uObtained = lpPoolU - newU;    // ç”¨æˆ·å–å‡ºå¾—åˆ°çš„Uï¼ˆç¨å‰ï¼‰
        if (uObtained <= 0) return;

        const tax = uObtained * TAX;
        const netU = uObtained - tax;
        const avgPrice = uObtained / amountH;

        lastSpent = -netU;          // è´Ÿå€¼è¡¨ç¤ºè·å¾—U
        lastObtained = -amountH;    // è´Ÿå€¼è¡¨ç¤ºå‡å°‘H
        lastTradePrice = avgPrice;
        lastTax = tax;
        totalSellH += amountH;

        lpPoolU = newU;
        lpPoolH = newH;
        treasury += tax;

        performBuyback();    // å°è¯•å›è´­
        refreshAll();
    }

    // ---------- é‡ç½®åˆå§‹çŠ¶æ€ ----------
    function resetToInitial() {
        communityH = 682_648_402;
        stakePoolH = 300_000_000;
        lpPoolH = 17_351_598;
        lpPoolU = 110_000;
        treasury = 0;
        multiSig = 0;
        buybackCount = 0;
        totalBuybackH = 0;
        lastBuybackH = 0;
        lastBuybackPrice = lpPoolU / lpPoolH;
        totalBuyUSDT = 0;
        totalSellH = 0;
        lastSpent = 0;
        lastObtained = 0;
        lastTradePrice = lpPoolU / lpPoolH;
        lastTax = 0;
        refreshAll();
    }

    // ---------- åˆ·æ–°æ‰€æœ‰æ˜¾ç¤º ----------
    function refreshAll() {
        const external = getExternalH();
        const price = lpPoolU / lpPoolH;
        const total = TOTAL_SUPPLY;  // æ€»å’Œæ’ä¸º10äº¿

        // æŒå¸åˆ†å¸ƒ
        communitySpan.innerText = formatNumber(communityH);
        stakeSpan.innerText = formatNumber(stakePoolH);
        externalSpan.innerText = formatNumber(external);
        lpHSpan.innerText = formatNumber(lpPoolH);
        communityPct.innerText = ((communityH / total) * 100).toFixed(2) + '%';
        stakePct.innerText = ((stakePoolH / total) * 100).toFixed(2) + '%';
        externalPct.innerText = ((external / total) * 100).toFixed(2) + '%';
        lpPct.innerText = ((lpPoolH / total) * 100).toFixed(2) + '%';

        // æµåŠ¨æ±  & ä»·æ ¼
        poolUSpan.innerText = formatNumber(lpPoolU);
        poolHSpan.innerText = formatNumber(lpPoolH);
        currentPriceSpan.innerText = formatPrice(price);

        // å›½åº“/å¤šç­¾/å›è´­
        treasuryBalSpan.innerText = formatFloat(treasury);
        multiSigBalSpan.innerText = formatFloat(multiSig);
        buybackCountSpan.innerText = buybackCount;
        buybackTotalHSpan.innerText = formatNumber(totalBuybackH);
        const dividend = treasury * 0.1;
        dividendPoolSpan.innerText = formatFloat(dividend);

        // æœ€è¿‘äº¤æ˜“ï¼ˆæ ¹æ®æ¨¡å¼å¾®è°ƒæ˜¾ç¤ºï¼‰
        if (isBuyMode) {
            lastSpentSpan.innerText = formatFloat(lastSpent, 2);
            lastObtainedSpan.innerText = formatNumber(lastObtained);
        } else {
            lastSpentSpan.innerText = formatFloat(Math.abs(lastSpent), 2);
            lastObtainedSpan.innerText = '-' + formatNumber(Math.abs(lastObtained));
        }
        lastPriceSpan.innerText = formatPrice(lastTradePrice);
        lastTaxSpan.innerText = formatFloat(lastTax, 2);
        totalBuyUSpan.innerText = formatFloat(totalBuyUSDT, 2);
        totalSellHSpan.innerText = formatNumber(totalSellH);

        // å›è´­å†å²
        lastBuybackHSpan.innerText = formatNumber(lastBuybackH);
        lastBuybackPriceSpan.innerText = formatPrice(lastBuybackPrice);
        cumBuybackHSpan.innerText = formatNumber(totalBuybackH);

        // è´¨æŠ¼ç›¸å…³
        externalForStake.innerText = formatNumber(external);
        updateStakeReward();

        // ç ¸ç›˜é¢„è§ˆæ›´æ–°ï¼ˆä»…æ˜¾ç¤ºå½“å‰å¤–éƒ¨æŒå¸å’Œä»·æ ¼ï¼Œä¸æ¸…ç©ºä¹‹å‰æ¨¡æ‹Ÿç»“æœï¼‰
        dumpExternalDisplay.innerText = formatNumber(external);
        dumpCurrentPriceDisplay.innerText = formatPrice(price);
    }

    // æ›´æ–°è´¨æŠ¼æ”¶ç›Šé¢„è§ˆ
    function updateStakeReward() {
        const external = getExternalH();
        const rate = parseFloat(stakeDuration.value) / 100;
        const dailyH = external * rate;
        dailyRewardSpan.innerText = formatNumber(dailyH);
        const price = lpPoolU / lpPoolH;
        dailyUsdtSpan.innerText = formatFloat(dailyH * price, 2);
        const days = parseInt(stakeDays.value) || 0;
        const cumH = dailyH * days;
        cumulativeRewardSpan.innerText = formatNumber(cumH);
        cumulativeValueSpan.innerText = formatFloat(cumH * price, 2);
    }

    // ç ¸ç›˜æ¨¡æ‹Ÿï¼ˆåŸºäºå½“å‰å¤–éƒ¨æŒå¸ï¼Œä¸€æ¬¡æ€§å–å‡ºï¼‰
    function simulateDump() {
        const external = getExternalH();
        if (external <= 0) {
            alert('å½“å‰å¤–éƒ¨æŒå¸ä¸º0ï¼Œæ— æ³•æ¨¡æ‹Ÿç ¸ç›˜');
            return;
        }

        const days = parseInt(dumpDaysInput.value);
        if (isNaN(days) || days <= 0) {
            alert('è¯·è¾“å…¥æœ‰æ•ˆçš„å¤©æ•°');
            return;
        }

        const rate = parseFloat(stakeDuration.value) / 100;  // æ—¥åˆ©ç‡
        const dailyReward = external * rate;                  // æ¯æ—¥æ”¶ç›Š
        const totalReward = dailyReward * days;               // ç´¯è®¡æ”¶ç›Š
        const totalH = external + totalReward;                // æ€»ç ¸ç›˜é‡

        // ä½¿ç”¨å½“å‰æµåŠ¨æ€§æ± æ·±åº¦æ¨¡æ‹Ÿå–å‡ºï¼ˆæ’å®šä¹˜ç§¯ï¼‰
        const k = lpPoolU * lpPoolH;
        const newH = lpPoolH + totalH;
        const newU = k / newH;
        const uObtained = lpPoolU - newU;                     // å–å‡ºå¾—åˆ°çš„USDTï¼ˆç¨å‰ï¼‰
        if (uObtained <= 0) {
            alert('æ¨¡æ‹Ÿå–å‡ºæ— æ³•è·å¾—USDTï¼Œå¯èƒ½æ± å­æ·±åº¦ä¸è¶³');
            return;
        }

        const tax = uObtained * TAX;                           // äº¤æ˜“ç¨
        const netU = uObtained - tax;                          // å®é™…å¾—åˆ°U
        const oldPrice = lpPoolU / lpPoolH;                    // å½“å‰ä»·æ ¼
        const newPrice = newU / newH;                          // å–å‡ºåä»·æ ¼
        const marketValue = external * oldPrice;                // å½“å‰å¤–éƒ¨æŒå¸å¸‚å€¼

        // äºæŸè®¡ç®—ï¼šå¸‚å€¼ - å‡€å¾—U
        const loss = marketValue - netU;

        // æ˜¾ç¤ºç»“æœ
        dumpRewardHSpan.innerText = formatNumber(totalReward);
        totalDumpHSpan.innerText = formatNumber(totalH);
        dumpAfterPriceSpan.innerText = formatPrice(newPrice);
        dumpObtainedUSpan.innerText = formatFloat(uObtained, 2);
        dumpTaxSpan.innerText = formatFloat(tax, 2);
        dumpNetUSpan.innerText = formatFloat(netU, 2);
        dumpMarketValueSpan.innerText = formatFloat(marketValue, 2);
        dumpLossUSpan.innerText = formatFloat(loss, 2);
        const lossRate = (loss / marketValue * 100).toFixed(2);
        dumpLossRateSpan.innerText = (loss > 0 ? lossRate : '0.00') + '%';
    }

    // ---------- äº‹ä»¶ç»‘å®š ----------
    modeBuyBtn.onclick = () => {
        isBuyMode = true;
        modeBuyBtn.classList.add('active');
        modeSellBtn.classList.remove('active');
        sliderLabel.innerText = 'ä¹°å…¥é‡‘é¢ (USDT)';
        actionSlider.min = 100;
        actionSlider.max = 100000;
        actionSlider.step = 100;
        actionSlider.value = 1000;
        sliderValue.innerText = '1,000';
        sliderUnit.innerText = 'USDT';
        refreshAll();   // æ›´æ–°æœ€è¿‘äº¤æ˜“æ˜¾ç¤ºæ ¼å¼
    };
    modeSellBtn.onclick = () => {
        isBuyMode = false;
        modeSellBtn.classList.add('active');
        modeBuyBtn.classList.remove('active');
        sliderLabel.innerText = 'å–å‡ºæ•°é‡ (ä¸‡H)';
        actionSlider.min = 1;
        actionSlider.max = 2000;      // æœ€å¤§2000ä¸‡H
        actionSlider.step = 1;
        actionSlider.value = 5;
        sliderValue.innerText = '5';
        sliderUnit.innerText = 'ä¸‡ H';
        refreshAll();
    };
    actionSlider.oninput = () => {
        let val = parseInt(actionSlider.value);
        sliderValue.innerText = val.toLocaleString();
    };
    executeBtn.onclick = () => {
        let v = parseFloat(actionSlider.value);
        if (isNaN(v) || v <= 0) return;
        if (isBuyMode) {
            executeBuy(v);
        } else {
            executeSell(v * 10000);   // ä¸‡Hè½¬ä¸ºH
        }
    };
    resetBtn.onclick = resetToInitial;

    stakeDuration.onchange = updateStakeReward;
    stakeDays.oninput = updateStakeReward;

    simulateDumpBtn.onclick = simulateDump;

    // åˆå§‹åŒ–
    resetToAll();
})();
</script>
</body>
</html>
